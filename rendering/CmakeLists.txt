cmake_minimum_required(VERSION 3.11)
project(hexaboard_viewer)

set(CMAKE_CXX_STANDARD 17)

# Platform detection
if(EMSCRIPTEN)
    set(PLATFORM_WEB TRUE)
    message(STATUS "Building for WebAssembly")
else()
    set(PLATFORM_DESKTOP TRUE)
    message(STATUS "Building for Desktop")
endif()

# Raylib
find_package(raylib QUIET)
if (NOT raylib_FOUND)
    include(FetchContent)
    FetchContent_Declare(
        raylib
        GIT_REPOSITORY https://github.com/raysan5/raylib.git
        GIT_TAG 5.0
    )
    FetchContent_MakeAvailable(raylib)
endif()

# Executable
add_executable(${PROJECT_NAME} main.cpp)

# Platform-specific settings
if(PLATFORM_WEB)
    # WebAssembly specific flags
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DPLATFORM_WEB")
    set(CMAKE_EXECUTABLE_SUFFIX ".html")
    
    # Emscripten link flags
    set_target_properties(${PROJECT_NAME} PROPERTIES 
        LINK_FLAGS "-s USE_GLFW=3 -s ASSERTIONS=1 -s WASM=1 -s ASYNCIFY -s GL_ENABLE_GET_PROC_ADDRESS=1 --preload-file ${CMAKE_SOURCE_DIR}/Assets@Assets/"
    )
    
    target_link_libraries(${PROJECT_NAME} raylib)
else()
    # Desktop specific
    target_compile_definitions(${PROJECT_NAME} PRIVATE PLATFORM_DESKTOP)
    target_link_libraries(${PROJECT_NAME} raylib)
    
    # macOS specific
    if(APPLE)
        target_link_libraries(${PROJECT_NAME} "-framework IOKit" "-framework Cocoa" "-framework OpenGL")
    endif()
endif()